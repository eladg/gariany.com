/*!
 * Talkyard v0.6.28-WIP-1-17e33ad7a
 *
 * This file is copyrighted and licensed under the AGPL license.
 * Some parts of it might be licensed under more permissive
 * licenses, e.g. MIT or Apache 2. Find the source code and
 * exact details here:
 *   https://github.com/debiki/debiki-server
 */
window.eds={},window.debiki={internal:{},v0:{util:{}}},debiki.internal.commentsServerOrigin=window.talkyardServerUrl||window.talkyardCommentsServerUrl||window.edCommentsServerUrl||function(){for(var e,t=document.getElementsByTagName("script"),n=0;n<t.length;++n){script=t[n];var r=script.src,o=-1!==r.search(/\/-\/ed-comments.(min\.)?js/);o||(o=-1!==r.search(/\/-\/talkyard-comments.(min\.)?js/)),o&&(e=r.match(/^[^/]*\/\/[^/]+/)[0])}return!e&&console.error&&console.error("Error extracting Talkyard embedded comments server origin, is there no '/-/talkyard-comments.min.js' script?"),e}(),debiki.internal.commentsServerOrigin=debiki.internal.commentsServerOrigin.replace(/\/+\s*$/,""),function(){!function(){"use strict";function e(t,n,o){return n=void 0===n?1:n,(o=o||n+1)-n<=1?function(){if(arguments.length<=n||"string"===r.type(arguments[n]))return t.apply(this,arguments);var e,o=arguments[n];for(var i in o){var s=Array.from(arguments);s.splice(n,1,i,o[i]),e=t.apply(this,s)}return e}:e(e(t,n+1,o),n,o-1)}function t(e,r,o){var i=n(o);if("string"===i){var s=Object.getOwnPropertyDescriptor(r,o);!s||s.writable&&s.configurable&&s.enumerable&&!s.get&&!s.set?e[o]=r[o]:(delete e[o],Object.defineProperty(e,o,s))}else if("array"===i)o.forEach(function(n){n in r&&t(e,r,n)});else for(var a in r)o&&("regexp"===i&&!o.test(a)||"function"===i&&!o.call(r,a))||t(e,r,a);return e}function n(e){if(null===e)return"null";if(void 0===e)return"undefined";var t=(Object.prototype.toString.call(e).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==t&&isNaN(e)?"nan":t}var r=self.Bliss=t(function(e,t){return 2==arguments.length&&!t||!e?null:"string"===r.type(e)?(t||document).querySelector(e):e||null},self.Bliss);t(r,{extend:t,overload:e,type:n,property:r.property||"_",sources:{},noop:function(){},$:function(e,t){return e instanceof Node||e instanceof Window?[e]:2!=arguments.length||t?Array.from("string"==typeof e?(t||document).querySelectorAll(e):e||[]):[]},defined:function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},create:function(e,t){return e instanceof Node?r.set(e,t):(1===arguments.length&&("string"===r.type(e)?t={}:(e=(t=e).tag,t=r.extend({},t,function(e){return"tag"!==e}))),r.set(document.createElement(e||"div"),t))},each:function(e,t,n){n=n||{};for(var r in e)n[r]=t.call(e,r,e[r]);return n},ready:function(e){return e=e||document,new Promise(function(t,n){"loading"!==e.readyState?t():e.addEventListener("DOMContentLoaded",function(){t()})})},Class:function(e){var t,n=["constructor","extends","abstract","static"].concat(Object.keys(r.classProps)),o=e.hasOwnProperty("constructor")?e.constructor:r.noop;2==arguments.length?(t=arguments[0],e=arguments[1]):((t=function(){if(this.constructor.__abstract&&this.constructor===t)throw new Error("Abstract classes cannot be directly instantiated.");t.super&&t.super.apply(this,arguments),o.apply(this,arguments)}).super=e.extends||null,t.prototype=r.extend(Object.create(t.super?t.super.prototype:Object),{constructor:t}),t.prototype.super=t.super?t.super.prototype:null,t.__abstract=!!e.abstract);var i=function(e){return this.hasOwnProperty(e)&&-1===n.indexOf(e)};if(e.static){r.extend(t,e.static,i);for(var s in r.classProps)s in e.static&&r.classProps[s](t,e.static[s])}r.extend(t.prototype,e,i);for(var s in r.classProps)s in e&&r.classProps[s](t.prototype,e[s]);return t},classProps:{lazy:e(function(e,t,n){return Object.defineProperty(e,t,{get:function(){var e=n.call(this);return Object.defineProperty(this,t,{value:e,configurable:!0,enumerable:!0,writable:!0}),e},set:function(e){Object.defineProperty(this,t,{value:e,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),e}),live:e(function(e,t,n){return"function"===r.type(n)&&(n={set:n}),Object.defineProperty(e,t,{get:function(){var e=this["_"+t],r=n.get&&n.get.call(this,e);return void 0!==r?r:e},set:function(e){var r=this["_"+t],o=n.set&&n.set.call(this,e,r);this["_"+t]=void 0!==o?o:e},configurable:n.configurable,enumerable:n.enumerable}),e})},include:function(){var e=arguments[arguments.length-1],t=2===arguments.length&&arguments[0],n=document.createElement("script");return t?Promise.resolve():new Promise(function(t,o){r.set(n,{async:!0,onload:function(){t(),r.remove(n)},onerror:function(){o()},src:e,inside:document.head})})},fetch:function(e,n){if(!e)throw new TypeError("URL parameter is mandatory and cannot be "+e);var o=t({url:new URL(e,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},n);o.method=o.method.toUpperCase(),r.hooks.run("fetch-args",o),"GET"===o.method&&o.data&&(o.url.search+=o.data),document.body.setAttribute("data-loading",o.url),o.xhr.open(o.method,o.url.href,!1!==o.async,o.user,o.password);for(var i in n)if(i in o.xhr)try{o.xhr[i]=n[i]}catch(e){self.console&&console.error(e)}"GET"===o.method||o.headers["Content-type"]||o.headers["Content-Type"]||o.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var s in o.headers)o.xhr.setRequestHeader(s,o.headers[s]);var a=new Promise(function(e,t){o.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===o.xhr.status||o.xhr.status>=200&&o.xhr.status<300||304===o.xhr.status?e(o.xhr):t(r.extend(Error(o.xhr.statusText),{xhr:o.xhr,get status(){return this.xhr.status}}))},o.xhr.onerror=function(){document.body.removeAttribute("data-loading"),t(r.extend(Error("Network Error"),{xhr:o.xhr}))},o.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),t(r.extend(Error("Network Timeout"),{xhr:o.xhr}))},o.xhr.send("GET"===o.method?null:o.data)});return a.xhr=o.xhr,a},value:function(e){var t="string"!==r.type(e);return r.$(arguments).slice(+t).reduce(function(e,t){return e&&e[t]},t?e:self)}}),r.Hooks=new r.Class({add:function(e,t,n){if("string"==typeof arguments[0])(Array.isArray(e)?e:[e]).forEach(function(e){this[e]=this[e]||[],t&&this[e][n?"unshift":"push"](t)},this);else for(var e in arguments[0])this.add(e,arguments[0][e],arguments[1])},run:function(e,t){this[e]=this[e]||[],this[e].forEach(function(e){e.call(t&&t.context?t.context:t,t)})}}),r.hooks=new r.Hooks;var o=r.property;r.Element=function(e){this.subject=e,this.data={},this.bliss={}},r.Element.prototype={set:e(function(e,t){e in r.setProps?r.setProps[e].call(this,t):e in this?this[e]=t:this.setAttribute(e,t)},0),transition:function(e,t){return t=+t||400,new Promise(function(n,o){if("transition"in this.style){var i=r.extend({},this.style,/^transition(Duration|Property)$/);r.style(this,{transitionDuration:(t||400)+"ms",transitionProperty:Object.keys(e).join(", ")}),r.once(this,"transitionend",function(){clearTimeout(s),r.style(this,i),n(this)});var s=setTimeout(n,t+50,this);r.style(this,e)}else r.style(this,e),n(this)}.bind(this))},fire:function(e,t){var n=document.createEvent("HTMLEvents");return n.initEvent(e,!0,!0),this.dispatchEvent(r.extend(n,t))},unbind:e(function(e,t){(e||"").split(/\s+/).forEach(function(e){if(o in this&&(e.indexOf(".")>-1||!t)){var n=(e=(e||"").split("."))[1];e=e[0];var r=this[o].bliss.listeners=this[o].bliss.listeners||{};for(var i in r)if(!e||i===e)for(var s,a=0;s=r[i][a];a++)n&&n!==s.className||t&&t!==s.callback||(this.removeEventListener(i,s.callback,s.capture),a--)}else this.removeEventListener(e,t)},this)},0)},r.setProps={style:function(e){for(var t in e)t in this.style?this.style[t]=e[t]:this.style.setProperty(t,e[t])},attributes:function(e){for(var t in e)this.setAttribute(t,e[t])},properties:function(e){r.extend(this,e)},events:function(e){if(e&&e.addEventListener){var t=this;if(e[o]&&e[o].bliss){var n=e[o].bliss.listeners;for(var i in n)n[i].forEach(function(e){t.addEventListener(i,e.callback,e.capture)})}for(var s in e)0===s.indexOf("on")&&(this[s]=e[s])}else if(arguments.length>1&&"string"===r.type(e)){var a=arguments[1],d=arguments[2];e.split(/\s+/).forEach(function(e){this.addEventListener(e,a,d)},this)}else for(var l in e)r.events(this,l,e[l])},once:e(function(e,t){var n=this,r=function(){return e.forEach(function(e){n.removeEventListener(e,r)}),t.apply(n,arguments)};(e=e.split(/\s+/)).forEach(function(e){n.addEventListener(e,r)})},0),delegate:e(function(e,t,n){this.addEventListener(e,function(e){e.target.closest&&e.target.closest(t)&&n.call(this,e)})},0,2),contents:function(e){(e||0===e)&&(Array.isArray(e)?e:[e]).forEach(function(e){var t=r.type(e);/^(string|number)$/.test(t)?e=document.createTextNode(e+""):"object"===t&&(e=r.create(e)),e instanceof Node&&this.appendChild(e)},this)},inside:function(e){e.appendChild(this)},before:function(e){e.parentNode.insertBefore(this,e)},after:function(e){e.parentNode.insertBefore(this,e.nextSibling)},start:function(e){e.insertBefore(this,e.firstChild)},around:function(e){e.parentNode&&r.before(this,e),(/^template$/i.test(this.nodeName)?this.content||this:this).appendChild(e)}},r.Array=function(e){this.subject=e},r.Array.prototype={all:function(e){var t=$$(arguments).slice(1);return this[e].apply(this,t)}},r.add=e(function(e,t,n,o){n=r.extend({$:!0,element:!0,array:!0},n),"function"==r.type(t)&&(!n.element||e in r.Element.prototype&&o||(r.Element.prototype[e]=function(){return this.subject&&r.defined(t.apply(this.subject,arguments),this.subject)}),!n.array||e in r.Array.prototype&&o||(r.Array.prototype[e]=function(){var e=arguments;return this.subject.map(function(n){return n&&r.defined(t.apply(n,e),n)})}),n.$&&(r.sources[e]=r[e]=t,(n.array||n.element)&&(r[e]=function(){var t=[].slice.apply(arguments),o=t.shift(),i=n.array&&Array.isArray(o)?"Array":"Element";return r[i].prototype[e].apply({subject:o},t)})))},0),r.add(r.Array.prototype,{element:!1}),r.add(r.Element.prototype),r.add(r.setProps),r.add(r.classProps,{element:!1,array:!1});var i=document.createElement("_");r.add(r.extend({},HTMLElement.prototype,function(e){return"function"===r.type(i[e])}),null,!0)}(),function(e,t){"use strict";function n(e,t){this.scrollLeft=e,this.scrollTop=t}function r(t){t.frame=e.requestAnimationFrame(r.bind(e,t));var n,i,a,d=(s()-t.startTime)/o;n=function(e){return.5*(1-Math.cos(Math.PI*e))}(d=d>1?1:d),i=t.startX+(t.x-t.startX)*n,a=t.startY+(t.y-t.startY)*n,t.method.call(t.scrollable,i,a),i===t.x&&a===t.y&&e.cancelAnimationFrame(t.frame)}e.HTMLElement||e.Element;var o=468,i={scroll:e.scroll||e.scrollTo},s=e.performance&&e.performance.now?e.performance.now.bind(e.performance):Date.now;e.smoothScroll=function(o,a,d){var l,c,u,m,f=s();o===t.body?(l=e,c=e.scrollX||e.pageXOffset,u=e.scrollY||e.pageYOffset,m=i.scroll):(l=o,c=o.scrollLeft,u=o.scrollTop,m=n),r({scrollable:l,method:m,startTime:f,startX:c,startY:u,x:a,y:d,frame:void 0})}}(window,document),function(){({i:debiki.internal}).i.calcScrollRectIntoViewCoords=function(e,t){var n=t.marginTop||15,r=t.marginBottom||15,o=t.marginLeft||15,i=t.marginRight||15,s=window.innerHeight,a=window.innerWidth,d=document.querySelectorAll(".s_E-E");d&&d.length&&(s-=d[0].clientHeight);var l={top:e.top-n,bottom:e.bottom+r,left:e.left-o,right:e.right+i};"number"==typeof t.height&&(l.bottom=l.top+t.height+r);var c=t.parent.scrollTop,u=c;if(l.top<0)u=c+l.top;else if(l.bottom>s){u=c+(h=l.bottom-s),l.top-h<0&&(u=c+l.top)}var m=t.parent.scrollLeft,f=m;if(l.left<0)f=m+l.left;else if(l.right>a){var h;f=m+(h=l.right-a),l.left-h<0&&(f=m+l.left)}return{actualWinTop:c,actualWinLeft:m,desiredParentTop:u,desiredParentLeft:f,needsToScroll:c!==u||m!==f}}}.call(this),function(){function e(){d("iframe-parent: loadCommentsCreateEditor()");var e=document.getElementsByClassName("ed-comments");if(e.length||(e=document.getElementsByClassName("talkyard-comments")),e.length){var t=e[0];d("iframe-parent: found commentsElem");var n="embeddingUrl="+(window.location.origin+window.location.pathname+window.location.search),r=t.getAttribute("data-discussion-id");if(/[#?& \t\n]/.test(r)){var o="Bad discussion id: "+r+" [EdE8UKWB4]";throw d(o),Error(o)}var i=r?"discussionId="+r+"&":"",s=t.getAttribute("data-ed-page-id");s||(s=t.getAttribute("data-talkyard-page-id"));var p=(s?"edPageId="+s+"&":"")+i+n,g=y+"/-/embedded-comments?"+p,v=window.location.hash.indexOf("&loadWeinre")>=0;v&&(g+=location.hash),u=!1,c=Bliss.create("iframe",{id:"ed-embedded-comments",name:"edComments",src:g,height:0,style:{padding:0,margin:0,width:"100%",border:"none",overflow:"hidden"},allowtransparency:"true",frameborder:0,scrolling:"no",horizontalscrolling:"no",verticalscrolling:"no"}),Bliss.start(c,t),d("iframe-parent: inserted commentsIframe");var b=Bliss.create("p",{id:"ed-loading-comments",text:"Loading comments ..."});Bliss.start(b,t),f=Bliss.create("div",{id:"ed-editor-wrapper",style:{display:"none",width:"100%",left:0,position:"fixed","z-index":1e3,bottom:0,"box-sizing":"content-box",cursor:"ns-resize",boxShadow:"rgba(0, 0, 0, 0.4) 0 0 32px 10px",background:"hsl(0, 0%, 53%)",border:"none",borderTop:"1px solid hsl(0, 0%, 78%)",padding:"8px 0 0 0",margin:0}}),Bliss.inside(f,document.body),d("iframe-parent: inserted editorWrapper");var w=y+"/-/embedded-editor?"+p;v&&(w+=location.hash),m=Bliss.create("iframe",{id:"ed-embedded-editor",name:"edEditor",style:{display:"block",padding:0,margin:0,width:"100%",height:"100%",border:"none"},seamless:"seamless",src:w}),Bliss.inside(m,f),d("iframe-parent: inserted editorIframe"),function(){var e=window.location.hash.match(/^#comment-(\d+)$/);if(e){var t=e[1],n=parseInt(t);l=n+1}}(),function(){function e(e){var t=r-e.clientY+n;h.style.height=t+"px",f.style.height=t+"px"}function t(n){a(!1),document.documentElement.removeEventListener("mousemove",e,!1),document.documentElement.removeEventListener("mouseup",t,!1)}f.addEventListener("mousedown",function(o){a(!0),n=o.clientY,r=f.clientHeight,document.documentElement.addEventListener("mousemove",e,!1),document.documentElement.addEventListener("mouseup",t,!1)});var n=0,r=0}()}}function t(){d("iframe-parent: removeCommentsAndEditor()"),c&&(c.remove(),c=null,u=!1),m&&(m.remove(),m=null,f.remove(),f=null)}function n(){if(c)if(u){var e=c.getBoundingClientRect(),t=Math.min(window.innerHeight,e.bottom);o('["iframeOffsetWinSize", {"top":'+-e.top+', "height":'+t+"}]")}else setTimeout(n,1e3)}function r(e){return c&&c.contentWindow===e.source?c:m&&m.contentWindow===e.source?m:void 0}function o(e){c&&c.contentWindow.postMessage(e,y)}function i(e){m&&m.contentWindow.postMessage(e,y)}function s(e){if(e){if(f.style.display="block",!w){w=!0;var t=Math.max(Math.min(300,window.innerHeight),window.innerHeight/2.8);f.style.height=t+"px"}h.style.display="block",h.style.height=f.clientHeight+"px"}else f.style.display="none",h.style.display="none",o('["clearIsReplyingMarks", {}]')}function a(e){var t={style:{visibility:e?"hidden":"visible"}},n=document.getElementById("ed-embedded-comments"),r=document.getElementById("ed-embedded-editor");Bliss.set(n,t),Bliss.set(r,t)}var d=!1!==window.talkyardDebug&&0!==window.talkyardDebug&&window.console?window.console.log:function(){};d("iframe-parent: start (disable logging by setting talkyardDebug = false)");var l,c,u,m,f,h,p={i:debiki.internal},y=p.i.commentsServerOrigin;addEventListener("scroll",n),addEventListener("message",function(e){if(c){var t,a;try{if("string"==typeof e.data){var m=JSON.parse(e.data);t=m[0],a=m[1]}else t=e.data[0],a=e.data[1]}catch(e){return}var h;switch(t){case"iframeInited":d("iframe-parent: got 'iframeInited' message"),(h=r(e))===c&&(u=!0,l&&function(e){o('["scrollToPostNr", '+e+"]")}(l));break;case"setIframeSize":(function(e,t){e.style.height=t.height+"px",e.style.minHeight=280})(h=r(e),a),h===c&&setTimeout(n);var y=document.getElementById("ed-loading-comments");y&&y.parentNode.removeChild(y);break;case"scrollComments":!function(e,t){t.parent=document.documentElement.scrollTop?document.documentElement:document.body;var n=c.getBoundingClientRect(),r={top:e.top+n.top,bottom:e.bottom+n.top,left:e.left+n.left,right:e.right+n.left},o=p.i.calcScrollRectIntoViewCoords(r,t);o.needsToScroll&&smoothScroll(document.body,o.desiredParentLeft,o.desiredParentTop)}(a[0],a[1]);break;case"justLoggedIn":(h=r(e))===c?i(e.data):o(e.data);break;case"logoutClientSideOnly":(h=r(e))===c?(i(e.data),s(!1)):o(e.data);break;case"showEditor":s(!0);break;case"hideEditor":s(!1);break;case"maximizeEditor":!function(e){e?(g=f.style.height,v=f.style.borderTop,b=f.style.paddingTop,f.style.top=0,f.style.height="auto",f.style.borderTop="none",f.style.paddingTop="none"):(f.style.top="auto",f.style.height=g,f.style.borderTop=v,f.style.paddingTop=b)}(a);break;case"minimizeEditor":!function(e){var t=document.getElementById("ed-editor-wrapper");e?(g=t.style.height,v=t.style.borderTop,b=t.style.paddingTop,t.style.height="45px",t.style.borderTop="none",t.style.paddingTop="0px"):(t.style.height=g,t.style.borderTop=v,t.style.paddingTop=b)}(a);break;case"editorToggleReply":i(e.data);break;case"handleReplyResult":case"clearIsReplyingMarks":o(e.data);break;case"editorEditPost":i(e.data);break;case"handleEditResult":o(e.data)}}},!1);var g,v,b,w=!1;h=Bliss.create("div",{id:"ed-editor-placeholder",display:"none"}),Bliss.inside(h,document.body),e(),window.edRemoveCommentsAndEditor=t,window.edReloadCommentsAndEditor=e,window.talkyardRemoveCommentsAndEditor=t,window.talkyardReloadCommentsAndEditor=e}.call(this)}();